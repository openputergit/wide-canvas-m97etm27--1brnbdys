<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotion Recognition</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-detection"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/face-landmarks-detection"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
        }
        .camera-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto;
        }
        #emotion-canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        .suggestion-item {
            transition: all 0.3s ease;
        }
        .suggestion-item:hover {
            transform: translateX(5px);
        }
        .emotion-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% {
                opacity: 0.7;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.7;
            }
        }
        .language-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        @media (max-width: 640px) {
            .camera-container {
                width: 100%;
                height: auto;
            }
            #video, #emotion-canvas {
                width: 100%;
                height: auto;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="language-toggle">
            <button id="toggleLang" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-medium py-1 px-3 rounded-full text-sm">
                <span id="langIndicator">EN</span> <i class="bi bi-translate"></i>
            </button>
        </div>

        <h1 class="text-4xl font-bold text-center text-gray-800 mb-8" data-en="Emotion Recognition" data-hi="рднрд╛рд╡рдирд╛ рдкрд╣рдЪрд╛рди">Emotion Recognition</h1>
        
        <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <div class="camera-container mb-6">
                <video id="video" width="640" height="480" autoplay muted class="rounded-lg"></video>
                <canvas id="emotion-canvas" width="640" height="480" class="rounded-lg"></canvas>
            </div>

            <div class="text-center mb-6">
                <button id="startButton" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                    <i class="bi bi-camera-fill mr-2"></i><span data-en="Start Camera" data-hi="рдХреИрдорд░рд╛ рд╢реБрд░реВ рдХрд░реЗрдВ">Start Camera</span>
                </button>
            </div>

            <div class="mt-6">
                <h2 class="text-2xl font-semibold mb-4">
                    <span data-en="Detected Emotion:" data-hi="рдкрд╣рдЪрд╛рдиреА рдЧрдИ рднрд╛рд╡рдирд╛:">Detected Emotion:</span> 
                    <span id="emotion-result" class="text-blue-500 emotion-badge" data-en="Waiting..." data-hi="рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣рд╛ рд╣реИ...">Waiting...</span>
                </h2>
                
                <div id="suggestions" class="hidden bg-gray-50 p-6 rounded-lg">
                    <h3 class="text-xl font-semibold mb-4" data-en="Suggested Activities:" data-hi="рд╕реБрдЭрд╛рдИ рдЧрдИ рдЧрддрд┐рд╡рд┐рдзрд┐рдпрд╛рдВ:">Suggested Activities:</h3>
                    <ul id="suggestion-list" class="space-y-3">
                    </ul>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold mb-3" data-en="How it works:" data-hi="рдпрд╣ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:">How it works:</h3>
                <p class="text-gray-600" data-en="This application analyzes your facial expressions through your camera and identifies your emotional state. Based on the detected emotion, it provides personalized suggestions to help improve your mood or maintain positive emotions." data-hi="рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЖрдкрдХреЗ рдХреИрдорд░реЗ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЖрдкрдХреЗ рдЪреЗрд╣рд░реЗ рдХреЗ рднрд╛рд╡ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЖрдкрдХреА рднрд╛рд╡рдирд╛рддреНрдордХ рд╕реНрдерд┐рддрд┐ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рддрд╛ рд╣реИред рдкрд╣рдЪрд╛рдиреА рдЧрдИ рднрд╛рд╡рдирд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдпрд╣ рдЖрдкрдХреЗ рдореВрдб рдХреЛ рд╕реБрдзрд╛рд░рдиреЗ рдпрд╛ рд╕рдХрд╛рд░рд╛рддреНрдордХ рднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡реНрдпрдХреНрддрд┐рдЧрдд рд╕реБрдЭрд╛рд╡ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред">This application analyzes your facial expressions through your camera and identifies your emotional state. Based on the detected emotion, it provides personalized suggestions to help improve your mood or maintain positive emotions.</p>
            </div>
        </div>
    </div>

    <script>
        let isHindi = false;
        const toggleLang = document.getElementById('toggleLang');
        const langIndicator = document.getElementById('langIndicator');

        toggleLang.addEventListener('click', () => {
            isHindi = !isHindi;
            langIndicator.textContent = isHindi ? 'HI' : 'EN';
            updateLanguage();
        });

        function updateLanguage() {
            const elements = document.querySelectorAll('[data-en]');
            elements.forEach(el => {
                el.textContent = isHindi ? el.getAttribute('data-hi') : el.getAttribute('data-en');
            });
            updateEmotionText();
        }

        function updateEmotionText() {
            if (currentEmotion === "waiting") return;
            
            const emotionMap = {
                happy: { en: "Happy", hi: "рдЦреБрд╢" },
                sad: { en: "Sad", hi: "рджреБрдЦреА" },
                angry: { en: "Angry", hi: "рдХреНрд░реЛрдзрд┐рдд" },
                neutral: { en: "Neutral", hi: "рддрдЯрд╕реНрде" },
                surprised: { en: "Surprised", hi: "рдЖрд╢реНрдЪрд░реНрдпрдЪрдХрд┐рдд" },
                fearful: { en: "Fearful", hi: "рднрдпрднреАрдд" }
            };
            
            emotionResult.textContent = isHindi 
                ? emotionMap[currentEmotion].hi 
                : emotionMap[currentEmotion].en;
        }

        const suggestions = {
            happy: [
                { en: "Keep the positive energy flowing with some upbeat music! ЁЯО╡", hi: "рдХреБрдЫ рдЙрддреНрд╕рд╛рд╣реА рд╕рдВрдЧреАрдд рдХреЗ рд╕рд╛рде рд╕рдХрд╛рд░рд╛рддреНрдордХ рдКрд░реНрдЬрд╛ рдХреЛ рдмрдирд╛рдП рд░рдЦреЗрдВ! ЁЯО╡" },
                { en: "Share your joy with friends and family ЁЯСитАНЁЯСйтАНЁЯСж", hi: "рдЕрдкрдиреА рдЦреБрд╢реА рдХреЛ рджреЛрд╕реНрддреЛрдВ рдФрд░ рдкрд░рд┐рд╡рд╛рд░ рдХреЗ рд╕рд╛рде рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ ЁЯСитАНЁЯСйтАНЁЯСж" },
                { en: "Try something creative - maybe paint or draw! ЁЯОи", hi: "рдХреБрдЫ рд░рдЪрдирд╛рддреНрдордХ рдХрд░реЗрдВ - рд╢рд╛рдпрдж рдкреЗрдВрдЯ рдпрд╛ рдбреНрд░рд╛ рдХрд░реЗрдВ! ЁЯОи" },
                { en: "Go for a refreshing walk outside тЫ░я╕П", hi: "рдмрд╛рд╣рд░ рддрд╛рдЬрд╝рдЧреА рднрд░реА рд╕реИрд░ рдХреЗ рд▓рд┐рдП рдЬрд╛рдПрдВ тЫ░я╕П" }
            ],
            sad: [
                { en: "Watch your favorite comedy movie ЁЯОм", hi: "рдЕрдкрдиреА рдкрд╕рдВрджреАрджрд╛ рдХреЙрдореЗрдбреА рдлрд┐рд▓реНрдо рджреЗрдЦреЗрдВ ЁЯОм" },
                { en: "Call a close friend for a chat ЁЯУ▒", hi: "рдмрд╛рддрдЪреАрдд рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рдХрд░реАрдмреА рджреЛрд╕реНрдд рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ ЁЯУ▒" },
                { en: "Listen to uplifting music ЁЯО╡", hi: "рдЙрддреНрд╕рд╛рд╣рд╡рд░реНрдзрдХ рд╕рдВрдЧреАрдд рд╕реБрдиреЗрдВ ЁЯО╡" },
                { en: "Take a relaxing walk in nature ЁЯМ│", hi: "рдкреНрд░рдХреГрддрд┐ рдореЗрдВ рдЖрд░рд╛рдорджрд╛рдпрдХ рд╕реИрд░ рдХрд░реЗрдВ ЁЯМ│" }
            ],
            angry: [
                { en: "Try some deep breathing exercises ЁЯзШтАНтЩВя╕П", hi: "рдЧрд╣рд░реА рд╕рд╛рдВрд╕ рд▓реЗрдиреЗ рдХреЗ рд╡реНрдпрд╛рдпрд╛рдо рдХрд░реЗрдВ ЁЯзШтАНтЩВя╕П" },
                { en: "Go for a run or exercise ЁЯПГтАНтЩВя╕П", hi: "рджреМрдбрд╝рдиреЗ рдпрд╛ рд╡реНрдпрд╛рдпрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдПрдВ ЁЯПГтАНтЩВя╕П" },
                { en: "Write down your feelings ЁЯУЭ", hi: "рдЕрдкрдиреА рднрд╛рд╡рдирд╛рдУрдВ рдХреЛ рд▓рд┐рдЦ рд▓реЗрдВ ЁЯУЭ" },
                { en: "Listen to calming music ЁЯО╡", hi: "рд╢рд╛рдВрдд рд╕рдВрдЧреАрдд рд╕реБрдиреЗрдВ ЁЯО╡" }
            ],
            neutral: [
                { en: "Try something new today! ЁЯОп", hi: "рдЖрдЬ рдХреБрдЫ рдирдпрд╛ рдХрд░реЗрдВ! ЁЯОп" },
                { en: "Read an interesting book ЁЯУЪ", hi: "рдХреЛрдИ рджрд┐рд▓рдЪрд╕реНрдк рдХрд┐рддрд╛рдм рдкрдврд╝реЗрдВ ЁЯУЪ" },
                { en: "Learn a new skill online ЁЯТ╗", hi: "рдСрдирд▓рд╛рдЗрди рдПрдХ рдирдпрд╛ рдХреМрд╢рд▓ рд╕реАрдЦреЗрдВ ЁЯТ╗" },
                { en: "Plan something fun for later ЁЯУЕ", hi: "рдмрд╛рдж рдХреЗ рд▓рд┐рдП рдХреБрдЫ рдордЬреЗрджрд╛рд░ рдпреЛрдЬрдирд╛ рдмрдирд╛рдПрдВ ЁЯУЕ" }
            ],
            surprised: [
                { en: "Take a moment to process what surprised you ЁЯдФ", hi: "рдЬреЛ рдЖрдкрдХреЛ рдЖрд╢реНрдЪрд░реНрдпрдЪрдХрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЙрд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдХреНрд╖рдг рд▓реЗрдВ ЁЯдФ" },
                { en: "Share the surprising news with someone ЁЯТм", hi: "рдХрд┐рд╕реА рдХреЗ рд╕рд╛рде рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рд╕рдорд╛рдЪрд╛рд░ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ ЁЯТм" },
                { en: "Turn surprise into curiosity and learn more ЁЯУК", hi: "рдЖрд╢реНрдЪрд░реНрдп рдХреЛ рдЬрд┐рдЬреНрдЮрд╛рд╕рд╛ рдореЗрдВ рдмрджрд▓реЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ ЁЯУК" },
                { en: "Use this energy for something creative ЁЯОи", hi: "рдЗрд╕ рдКрд░реНрдЬрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рд░рдЪрдирд╛рддреНрдордХ рдХрд╛рдо рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ ЁЯОи" }
            ],
            fearful: [
                { en: "Practice mindfulness meditation ЁЯзШ", hi: "рдорд╛рдЗрдВрдбрдлреБрд▓рдиреЗрд╕ рдореЗрдбрд┐рдЯреЗрд╢рди рдХрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░реЗрдВ ЁЯзШ" },
                { en: "Talk to someone you trust about your fears ЁЯСе", hi: "рдЕрдкрдиреЗ рдбрд░ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХрд┐рд╕реА рднрд░реЛрд╕реЗрдордВрдж рд╡реНрдпрдХреНрддрд┐ рд╕реЗ рдмрд╛рдд рдХрд░реЗрдВ ЁЯСе" },
                { en: "Try grounding techniques (count 5 things you can see) ЁЯСБя╕П", hi: "рдЧреНрд░рд╛рдЙрдВрдбрд┐рдВрдЧ рддрдХрдиреАрдХреЛрдВ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ (5 рдЪреАрдЬреЗрдВ рдЧрд┐рдиреЗрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ) ЁЯСБя╕П" },
                { en: "Do something that makes you feel safe and comfortable ЁЯПа", hi: "рдХреБрдЫ рдРрд╕рд╛ рдХрд░реЗрдВ рдЬрд┐рд╕рд╕реЗ рдЖрдк рд╕реБрд░рдХреНрд╖рд┐рдд рдФрд░ рдЖрд░рд╛рдорджрд╛рдпрдХ рдорд╣рд╕реВрд╕ рдХрд░реЗрдВ ЁЯПа" }
            ]
        };

        let currentEmotion = "waiting";
        const video = document.getElementById('video');
        const canvas = document.getElementById('emotion-canvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const emotionResult = document.getElementById('emotion-result');
        const suggestionsDiv = document.getElementById('suggestions');
        const suggestionList = document.getElementById('suggestion-list');
        let faceDetectionModel = null;

        startButton.addEventListener('click', async () => {
            try {
                startButton.disabled = true;
                startButton.innerHTML = '<i class="bi bi-hourglass-split mr-2"></i><span data-en="Loading Models..." data-hi="рдореЙрдбрд▓ рд▓реЛрдб рд╣реЛ рд░рд╣реЗ рд╣реИрдВ...">Loading Models...</span>';
                startButton.classList.add('bg-yellow-500');
                updateLanguage();
                
                // Load face detection model
                faceDetectionModel = await faceDetection.SupportedModels.MediaPipeFaceDetector;
                const model = await faceDetection.createDetector(faceDetectionModel, {
                    runtime: 'tfjs',
                    modelType: 'short'
                });
                
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                
                startButton.innerHTML = '<i class="bi bi-camera-fill mr-2"></i><span data-en="Camera Active" data-hi="рдХреИрдорд░рд╛ рд╕рдХреНрд░рд┐рдп">Camera Active</span>';
                startButton.classList.remove('bg-yellow-500');
                startButton.classList.add('bg-green-500');
                updateLanguage();
                
                startDetection(model);
            } catch (err) {
                startButton.disabled = false;
                startButton.innerHTML = '<i class="bi bi-camera-fill mr-2"></i><span data-en="Start Camera" data-hi="рдХреИрдорд░рд╛ рд╢реБрд░реВ рдХрд░реЗрдВ">Start Camera</span>';
                startButton.classList.remove('bg-yellow-500');
                updateLanguage();
                alert('Error: ' + err.message);
                console.error(err);
            }
        });

        function updateSuggestions(emotion) {
            suggestionsDiv.classList.remove('hidden');
            suggestionList.innerHTML = '';
            const relevantSuggestions = suggestions[emotion] || suggestions.neutral;
            
            relevantSuggestions.forEach(suggestion => {
                const li = document.createElement('li');
                li.className = 'flex items-center space-x-2 text-gray-700 suggestion-item hover:bg-gray-100 p-2 rounded-lg';
                li.innerHTML = `<i class="bi bi-arrow-right-circle text-blue-500"></i><span>${isHindi ? suggestion.hi : suggestion.en}</span>`;
                suggestionList.appendChild(li);
            });
        }

        async function startDetection(model) {
            // For demo purposes, we'll simulate emotion detection
            // In a real implementation, you would use the face model to analyze expressions
            const emotions = ['happy', 'sad', 'angry', 'neutral', 'surprised', 'fearful'];
            let detectionInterval = setInterval(() => {
                const newEmotion = emotions[Math.floor(Math.random() * emotions.length)];
                
                if (newEmotion !== currentEmotion) {
                    currentEmotion = newEmotion;
                    updateEmotionText();
                    updateSuggestions(currentEmotion);
                }
            }, 5000);

            // Draw video feed to canvas with face detection
            async function drawVideoWithDetection() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                try {
                    // For a real implementation, you would use model detection here
                    // Simulating face detection rectangle
                    ctx.strokeStyle = '#00FF00';
                    ctx.lineWidth = 3;
                    const faceWidth = 150;
                    const faceHeight = 200;
                    ctx.strokeRect(
                        canvas.width/2 - faceWidth/2,
                        canvas.height/2 - faceHeight/2,
                        faceWidth,
                        faceHeight
                    );
                    
                    // Add emotion text above the face
                    if (currentEmotion !== "waiting") {
                        ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                        ctx.fillRect(
                            canvas.width/2 - 70,
                            canvas.height/2 - faceHeight/2 - 40,
                            140,
                            30
                        );
                        ctx.fillStyle = '#FFFFFF';
                        ctx.font = '16px Poppins';
                        ctx.textAlign = 'center';
                        ctx.fillText(
                            isHindi ? 
                                suggestions[currentEmotion][0].hi.split(' ')[0] : 
                                currentEmotion.toUpperCase(),
                            canvas.width/2,
                            canvas.height/2 - faceHeight/2 - 20
                        );
                    }
                } catch (error) {
                    console.error('Detection error:', error);
                }
                
                requestAnimationFrame(drawVideoWithDetection);
            }
            
            drawVideoWithDetection();
        }
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>